

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>groups.py &mdash; BundleWrap 2.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/bundlewrap.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="BundleWrap 2.0.0 documentation" href="index.html"/>
        <link rel="up" title="Repository reference" href="repository.html"/>
        <link rel="next" title="Bundles" href="bundles.html"/>
        <link rel="prev" title="nodes.py" href="nodes.py.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html">
        

        
          
          <img src="_static/logo.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-repository">Create a repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#run-a-command">Run a command</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-bundle">Create a bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-file-template">Create a file template</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#apply-configuration">Apply configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#using-pip">Using <cite>pip</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-git">From git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="migration_12.html">Migrating from BundleWrap 1.x to 2.x</a><ul>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#items-py">items.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#default-file-content-type">Default file content type</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#metadata-merging">Metadata merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#metadata-processors-and-item-generators">Metadata processors and item generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#custom-item-types">Custom item types</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_12.html#deterministic-templates">Deterministic templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements for managed systems</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="repository.html">Repository reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nodes.py.html">nodes.py</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">groups.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="bundles.html">Bundles</a></li>
<li class="toctree-l2"><a class="reference internal" href="hooks.html">Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_item.html">Custom item types</a></li>
<li class="toctree-l2"><a class="reference internal" href="libs.html">Custom code</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-apply"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">apply</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-run"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">run</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-nodes-and-bw-groups"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">nodes</span></code> and <code class="docutils literal"><span class="pre">bw</span> <span class="pre">groups</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-debug"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">debug</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-plot"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">plot</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html#bw-test"><code class="docutils literal"><span class="pre">bw</span> <span class="pre">test</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_contrib.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#submitting-bug-reports">Submitting bug reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#contributing-code">Contributing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contrib.html#help">Help</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#technical">Technical</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#the-bundlewrap-project">The BundleWrap Project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alternatives.html">Alternatives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#ansible">Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#bcfg2">BCFG2</a></li>
<li class="toctree-l2"><a class="reference internal" href="alternatives.html#chef">Chef</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">BundleWrap</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="repository.html">Repository reference</a> &raquo;</li>
      
    <li>groups.py</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="groups-py">
<span id="groupspy"></span><h1>groups.py<a class="headerlink" href="#groups-py" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>This file lets you specify or dynamically build a list of <a class="reference internal" href="glossary.html#term-group"><span class="xref std std-term">groups</span></a> in your environment.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>As with <code class="file docutils literal"><span class="pre">nodes.py</span></code>, you define your groups as a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;all&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;member_patterns&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">r&quot;.*&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="s">&#39;group1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;members&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">&#39;node1&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All group attributes are optional.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="group-attribute-reference">
<h2>Group attribute reference<a class="headerlink" href="#group-attribute-reference" title="Permalink to this headline">¶</a></h2>
<p>This section is a reference for all possible attributes you can define for a group:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">&#39;group1&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="c"># THIS PART IS EXPLAINED HERE</span>
     <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="bundles">
<h3><code class="docutils literal"><span class="pre">bundles</span></code><a class="headerlink" href="#bundles" title="Permalink to this headline">¶</a></h3>
<p>A list of <a class="reference internal" href="bundles.html"><em>bundles</em></a> to be assigned to each node in this group.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="member-patterns">
<h3><code class="docutils literal"><span class="pre">member_patterns</span></code><a class="headerlink" href="#member-patterns" title="Permalink to this headline">¶</a></h3>
<p>A list of regular expressions. Node names matching these expressions will be added to the group members.</p>
<p>Matches are determined using <a class="reference external" href="http://docs.python.org/2/library/re.html#re.RegexObject.search">the search() method</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="members">
<h3><code class="docutils literal"><span class="pre">members</span></code><a class="headerlink" href="#members" title="Permalink to this headline">¶</a></h3>
<p>A tuple or list of node names that belong to this group.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="metadata">
<span id="group-metadata"></span><h3><code class="docutils literal"><span class="pre">metadata</span></code><a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>A dictionary of arbitrary data that will be accessible from each node&#8217;s <code class="docutils literal"><span class="pre">node.metadata</span></code>. For each node, BundleWrap will merge the metadata of all of the node&#8217;s groups first, then merge in the metadata from the node itself.</p>
<p>Metadata is merged recursively by default, meaning nested dicts will overwrite each other. Lists will be appended to each other, but not recursed into. In come cases, you want to overwrite instead of merge a piece of metadata. This is accomplished through the use of <code class="docutils literal"><span class="pre">bundlewrap.metadata.atomic()</span></code> and best illustrated as an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">bundlewrap.metadata</span> <span class="kn">import</span> <span class="n">atomic</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;all&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;interfaces&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;eth0&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
            <span class="s">&#39;nameservers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="s">&quot;8.8.4.4&quot;</span><span class="p">],</span>
            <span class="s">&#39;ntp_servers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;pool.ntp.org&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;internal&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;metadata&#39;</span><span class="p">:</span>
            <span class="s">&#39;interfaces&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&#39;eth1&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
            <span class="s">&#39;nameservers&#39;</span><span class="p">:</span> <span class="n">atomic</span><span class="p">([</span><span class="s">&quot;10.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;10.0.0.2&quot;</span><span class="p">]),</span>
            <span class="s">&#39;ntp_servers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;10.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;10.0.0.2&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A node in both groups will end up with <code class="docutils literal"><span class="pre">eth0</span></code> <strong>and</strong> <code class="docutils literal"><span class="pre">eth1</span></code>.</p>
<p>The nameservers however are overwritten, so that nodes what are in both the <em>all</em> <strong>and</strong> the <em>internal</em> group will only have the <code class="docutils literal"><span class="pre">10.0.0.x</span></code> ones while nodes just in the <em>all</em> group will have the <code class="docutils literal"><span class="pre">8.8.x.x</span></code> nameservers.</p>
<p>The NTP servers are appended: a node in both groups will have all three nameservers.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful when defining conflicting metadata (i.e. dictionaries that have some common keys) in multiple groups. BundleWrap will consider group hierarchy when merging metadata. For example, it is possible to define a default nameserver for the &#8220;eu&#8221; group and then override it for the &#8220;eu.frankfurt&#8221; subgroup. The catch is that this only works for groups that are connected through a subgroup hierarchy. Independent groups will have their metadata merged in an undefined order.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="os">
<h3><code class="docutils literal"><span class="pre">os</span></code><a class="headerlink" href="#os" title="Permalink to this headline">¶</a></h3>
<p>Changes the <a class="reference internal" href="nodes.py.html#node-os"><span>default OS</span></a> for nodes in this group. Subgroups can override this for their parent groups.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="subgroups">
<h3><code class="docutils literal"><span class="pre">subgroups</span></code><a class="headerlink" href="#subgroups" title="Permalink to this headline">¶</a></h3>
<p>A tuple or list of group names whose members should be recursively included in this group.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bundles.html" class="btn btn-neutral float-right" title="Bundles" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="nodes.py.html" class="btn btn-neutral" title="nodes.py" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>